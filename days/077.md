# Jenkins Deploy Pipeline

The development team of xFusionCorp Industries is working on to develop a new static website and they are planning to deploy the same on Nautilus App Servers using Jenkins pipeline. They have shared their requirements with the DevOps team and accordingly we need to create a Jenkins pipeline job. Please find below more details about the task:

Click on the Jenkins button on the top bar to access the Jenkins UI. Login using username `admin` and password `Adm!n321`.

Similarly, click on the Gitea button on the top bar to access the Gitea UI. Login using username `sarah` and password `Sarah_pass123`. There under user sarah you will find a repository named `web_app` that is already cloned on `Storage server` under `/var/www/html`. sarah is a developer who is working on this repository.

1. Add a slave node named `Storage Server`. It should be labeled as `ststor01` and its remote root directory should be `/var/www/html`.

2. We have already cloned repository on Storage Server under `/var/www/html`.

3. `Apache` is already installed on all app Servers its running on port `8080`.

4. Create a Jenkins pipeline job named `datacenter-webapp-job` (it must not be a Multibranch pipeline) and configure it to:

    - Deploy the code from web_app repository under /var/www/html on Storage Server, as this location is already mounted to the document root /var/www/html of app servers. The pipeline should have a single stage named Deploy ( which is case sensitive ) to accomplish the deployment.

LB server is already configured. You should be able to see the latest changes you made by clicking on the App button. Please make sure the required content is loading on the main URL `https://<LBR-URL>` i.e there should not be a sub-directory like `https://<LBR-URL>/web_app` etc.

Note:

- You might need to install some plugins and restart Jenkins service. So, we recommend clicking on Restart Jenkins when installation is complete and no jobs are running on plugin installation/update page i.e update centre. Also, Jenkins UI sometimes gets stuck when Jenkins service restarts in the back end. In this case, please make sure to refresh the UI page.

- For these kind of scenarios requiring changes to be done in a web UI, please take screenshots so that you can share it with us for review in case your task is marked incomplete. You may also consider using a screen recording software such as loom.com to record and share your work.

## Steps

0. Login into Storage server and install java

    ```sh
    sudo yum install java-21-openjdk -y
    ```

    > Add the permission of `/var/www/html` directory:  # "Perform this step before creating  "Storage server" Agent, as it prevents the error: 'This agent is offline because Jenkins failed to launch the agent process on it.'

    ```sh
    sudo chown -R natasha:natasha /var/www/html
    ```

1. Update plugins and restart jenkins
2. Install following plugins:
    - SSH Build Agent
    - Pipeline
3. Add storage server credential; Manage Jenkins > Credentials > System > Global > Add credentials:
    - username: `natasha`
    - Password: `Bl@kW`
    - ID: `ststor01`
4. Add agent:
    - name: `Storage Server`
    - remote dir: `/var/www/html`
    - label: `ststor01`
    - Launch Method: `SSH`
        - host: ststor01
        - credential: `natasha/pass`
        - host key: no verification
    - Save

5. Create a jenkins pipeline job:
    - name: `datacenter-webapp-job`
    - type: pipeline
    - Build steps: pipeline script
    - Add this pipeline script: [jenkins-pipeline-deploy.jenkinsfile](../files/jenkins-pipeline-deploy-077.jenkinsfile)

6. Build

## Good to Know?

### Jenkins Pipelines

- **Pipeline as Code**: Define build process in code
- **Version Control**: Store pipeline definitions in SCM
- **Declarative**: Structured, easy-to-read syntax
- **Scripted**: Flexible, Groovy-based syntax

### Pipeline Components

- **Stages**: Logical groupings of steps
- **Steps**: Individual actions (shell, git, etc.)
- **Agents**: Where pipeline executes
- **Post Actions**: Cleanup and notifications

### Deployment Pipelines

- **Source Control**: Pull code from repository
- **Build**: Compile and package application
- **Test**: Run automated tests
- **Deploy**: Deploy to target environment

### Best Practices

- **Modular Stages**: Break pipeline into logical stages
- **Error Handling**: Proper error handling and notifications
- **Parallel Execution**: Run independent tasks in parallel
- **Shared Libraries**: Reuse common pipeline code
